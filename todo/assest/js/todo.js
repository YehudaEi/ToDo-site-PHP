/*! Todo list | https://yehudae.ga | (c) 2019 Yehuda Eisenberg | MIT License */ 

var AllData,TempMatala,API_URL="?api&method=";function init(t){document.getElementById("addMatalaTitle").innerText="הוספת מטלה",document.getElementById("addMatalaButton").innerText="הוסף",document.getElementById("matalaTitle").value="",document.getElementById("matalaDescription").value="",document.getElementById("tagit-1").value="",document.getElementById("tagit-1-select").value="",document.getElementById("tagit-2").value="",document.getElementById("tagit-2-select").value="",document.getElementById("tagit-3").value="",document.getElementById("tagit-3-select").value="",document.getElementById("addMatalaButton").setAttribute("onClick","addOrEditMatala()"),t&&makeRequest("get").then(t=>{AllData=t,buildMatalot()})}function SaveMatalot(){let t={todo:[],doing:[],done:[],count:AllData.count};["todo","doing","done"].forEach(e=>{$("#"+e+" > div").each(function(){var a=findMatla($(this).data("matalaid"));a.type=e,t[e].push(a)})}),makeRequest("save",{data:JSON.stringify(t)})}function getTagitClass(t){return"1"==t?"uk-label-success":"2"==t?"uk-label-warning":"3"==t?"uk-label-danger":"4"==t?"":void 0}function buildMatalot(){buildMatala("todo"),buildMatala("doing"),buildMatala("done")}function buildMatala(t){text="",AllData[t].forEach(t=>{text+='<div class="uk-margin" data-matalaid="'+t.id+'"><div class="uk-card uk-card-default uk-card-body uk-card-small uk-text-center" style="padding-top:7px !important;">',t.tagiot.length>0&&(text+='<div class="label-containter uk-text-left">',t.tagiot.forEach(t=>{text+='<span class="uk-margin-small-left uk-label '+getTagitClass(t.type)+'">'+t.name+"</span>"}),text+="</div>"),text+='<ul uk-accordion="toggle: > .uk-accordion-title" class="">',text+="<li>",text+='<a class="uk-accordion-title uk-text-bold uk-overflow-auto" href="#">'+t.title+"</a>",text+='<div class="uk-accordion-content uk-overflow-auto">',text+="<p>"+t.description+"</p>",text+='<p class="uk-text-small uk-text-left">'+new Date(t.date).toLocaleString()+'<a href="#" title="עריכה" uk-icon="icon: pencil" onclick="editMatala('+t.id+')"></a>',text+='<a href="#" title="מחיקה" uk-icon="icon: trash" onclick="deleteMatala('+t.id+')"></a></p>',text+="</div></li></ul></div></div>"}),$("#"+t).html(text)}function addOrEditMatala(t){SaveMatalot();let e=document.getElementById("matalaTitle").value,a=document.getElementById("matalaDescription").value,l=document.getElementById("tagit-1").value,n=document.getElementById("tagit-1-select").value,i=document.getElementById("tagit-2").value,d=document.getElementById("tagit-2-select").value,o=document.getElementById("tagit-3").value,u=document.getElementById("tagit-3-select").value;if(""==e||null==e)return void alert("הכותרת ריקה");if(""==a||null==a)return void alert("התיאור ריק");let c=[];""!=l&&c.push({name:l,type:n}),""!=i&&c.push({name:i,type:d}),""!=o&&c.push({name:o,type:u}),matala={type:"todo",title:e,description:a,tagiot:c},void 0!==t?(matala.id=t,makeRequest("edit",{matala:JSON.stringify(matala)}).then(t=>{t.ok&&(UIkit.notification({message:"<span uk-icon='icon: check'></span> המטלה עודכנה",pos:"top-right"}),init(!0))})):makeRequest("add",{matala:JSON.stringify(matala)}).then(t=>{t.ok&&(UIkit.notification({message:"<span uk-icon='icon: check'></span> המטלה נוספה",pos:"top-right"}),init(!0))})}function editMatala(t){var e=findMatla(t);document.getElementById("addMatalaTitle").innerText="עריכת מטלה",document.getElementById("addMatalaButton").innerText="שמור",document.getElementById("addMatalaButton").setAttribute("onClick","addOrEditMatala("+t+")"),document.getElementById("matalaTitle").value=e.title,document.getElementById("matalaDescription").value=e.description,null!=e.tagiot[0]?(document.getElementById("tagit-1").value=e.tagiot[0].name,document.getElementById("tagit-1-select").value=e.tagiot[0].type):(document.getElementById("tagit-1").value="",document.getElementById("tagit-1-select").value=""),null!=e.tagiot[1]?(document.getElementById("tagit-2").value=e.tagiot[1].name,document.getElementById("tagit-2-select").value=e.tagiot[1].type):(document.getElementById("tagit-2").value="",document.getElementById("tagit-2-select").value=""),null!=e.tagiot[2]?(document.getElementById("tagit-3").value=e.tagiot[2].name,document.getElementById("tagit-3-select").value=e.tagiot[2].type):(document.getElementById("tagit-3").value="",document.getElementById("tagit-3-select").value=""),UIkit.modal("#add-matala-modal").show()}function deleteMatala(t){SaveMatalot();if(confirm("האם אתה בטוח שאתה רוצה למחוק את המטלה הזה?")){makeRequest("delete",{id:t}).then(t=>{t.ok&&(UIkit.notification({message:"<span uk-icon='icon: check'></span> המטלה נמחקה",pos:"top-right"}),init(!0))})}}function findMatla(e){let a=["todo","doing","done"];for(let l=0;l<a.length;l++){if(t=findWithAttr(AllData[a[l]],"id",e),null!=t)return t}}function findWithAttr(t,e,a){for(var l=0;l<t.length;l+=1)if(t[l][e]==a)return t[l];return null}function makeRequest(t,e=""){return $.ajax({type:"post",url:API_URL+t,data:e,dataType:"json"})}$(()=>init(!0)),window.onbeforeunload=function(){setTimeout(SaveMatalot,0)};